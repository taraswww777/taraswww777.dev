# Документация по скрипту `git_cleanup_branches.js`

## Теги

- #GIT 
- #SCRIPT_FOR_GIT

---
[[git_cleanup_branches doc]]

## Назначение
Скрипт для безопасного удаления удалённых веток Git, которые уже влиты в целевую ветку (по умолчанию `develop`), с интерактивным подтверждением и защитой критических веток.

## Защищённые ветки
По умолчанию защищены от удаления:
*   `develop`
*   `main`
*   `master`
*   Любые ветки, содержащие `/release/` в названии.

## Параметры запуска
Параметры передаются через аргументы командной строки в формате `ключ=значение`.

*   `targetBranch`: Целевая ветка, в которую были влиты все проверяемые ветки. **По умолчанию: `develop`**.
*   `step`: Запускает определённый этап скрипта для гибкости или перезапуска.
    *   `full`: (По умолчанию) Запускает полный процесс.
    *   `delete`: Пропускает все подготовительные шаги и сразу выполняет удаление веток, список которых берётся из заранее созданного файла `branches-for-delete.txt`.

## Использование

### Сценарий 1: Полный процесс (по умолчанию)
Запускает полный цикл: проверяет ветки, влитые в `develop`, выводит список и запрашивает подтверждение на удаление.
```bash
node git_cleanup_branches.js
```

### Сценарий 2: Указание целевой ветки
Запускает полный процесс, но проверяет ветки, влитые в `master`.
```bash
node git_cleanup_branches.js targetBranch=master
```

### Сценарий 3: Только удаление
Пропускает анализ и сразу удаляет ветки, перечисленные в файле `branches-for-delete.txt`. Полезно, если процесс был прерван после подтверждения.
```bash
node git_cleanup_branches.js step=delete
```

### Сценарий 4: Комбинирование параметров
Запускает удаление веток из файла `branches-for-delete.txt`, который был сформирован для целевой ветки `main`.
```bash
node git_cleanup_branches.js targetBranch=main step=delete
```

## Этапы работы (при step='full')
1.  **Переключение и обновление:** Скрипт переключается на целевую ветку и получает актуальную информацию с удалённого репозитория (`git fetch --all`).
2.  **Анализ:** Формируется список всех удалённых веток (`branches-before.txt`) и веток, уже влитых в целевую.
3.  **Фильтрация:** Из списка удаляются защищённые ветки.
4.  **Подтверждение:** Список кандидатов на удаление сохраняется в `branches-for-delete.txt` и выводится пользователю для подтверждения (y/n).
5.  **Удаление:** После подтверждения скрипт выполняет команды `git push origin --delete` для каждой ветки из списка.
6.  **Финальный снимок:** Сохраняется список оставшихся веток (`branches-after.txt`).

## Генерируемые файлы
*   `branches-before.txt` — Снимок всех веток до удаления.
*   `branches.txt` — Список кандидатов на удаление (полные имена с `origin/`).
*   `branches-for-delete.txt` — Список веток для удаления (короткие имена).
*   `branches-after.txt` — Снимок всех веток после удаления.